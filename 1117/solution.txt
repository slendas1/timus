Посмотрим на каком уровне находиться вершина i.
stages считаются с листьев (0 stage).
Тогда stage = количество нулей на конце i в битовой записи.
Расстояние между i и i + 1:
Одно из чисел неч - 0 stage
Другое четное - k stage
Тогда расстояние = k - 1
Осталось посчитать количество чисел от a + 1 до и b - 1, делящихся на 2 ** 30, 2 ** 29, ..., 2 ** 2 (2 ** 1 вклада не дает: k - 1 = 0),
домножить на 2 * (k - 1) и добавить к результирующей переменной. Домножения на 2 за счет 2ух нечетных соседов.
Отдельная проверка для step(a, a + 1), step(b - 1, b)